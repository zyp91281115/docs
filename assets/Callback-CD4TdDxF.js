import{d as N,j as h,c as s,u as e,o as n,w as p,e as l,t as i,f as a,b as T,a as x,N as m,a4 as C,g as v,_ as w}from"./app-BoVswreK.js";import{N as y}from"./Alert-Q_ipj1yW.js";import{N as M}from"./Input-SusbgFmp.js";const P=N({__name:"Callback",setup(S){const _=`${location.origin}/tool/dropbox/callback`,c=new URL(window.location.href),d=c.searchParams.get("code"),u=c.searchParams.get("state"),f=c.searchParams.get("error"),b=c.searchParams.get("error_description"),[k,g]=atob(u).split("::"),r=h({refreshToken:"",accessToken:"",error1:"",errorMessage1:""});return d&&u&&!f&&(()=>{fetch(`${v()}/alist/dropbox/token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:d,client_id:k,client_secret:g,grant_type:"authorization_code",redirect_uri:_})}).then(t=>t.json()).then(t=>{if(console.log(t),t.error){r.error1=t.error,r.errorMessage1=t.error_description;return}r.refreshToken=t.refresh_token,r.accessToken=t.access_token})})(),(t,o)=>!e(d)||!e(u)||e(f)?(n(),s(e(y),{key:0,title:e(f)||"Error",type:"error"},{default:p(()=>[l(i(e(b)),1)]),_:1},8,["title"])):(n(),s(e(m),{key:1,vertical:"",size:"large"},{default:p(()=>[a("p",null,[o[0]||(o[0]=a("b",null,"client_id: ",-1)),l(i(e(k)),1)]),a("p",null,[o[1]||(o[1]=a("b",null,"client_secret: ",-1)),l(i(e(g)),1)]),a("p",null,[o[2]||(o[2]=a("b",null,"redirect_uri: ",-1)),l(i(_))]),r.error1||r.errorMessage1?(n(),s(e(y),{key:0,title:r.error1,type:"error"},{default:p(()=>[l(i(r.errorMessage1),1)]),_:1},8,["title"])):T("",!0),x(e(m),{vertical:""},{default:p(()=>[o[3]||(o[3]=a("b",null,"refresh_token:",-1)),!r.refreshToken&&!r.errorMessage1?(n(),s(e(C),{key:0})):(n(),s(e(M),{key:1,type:"textarea",autosize:"",readonly:"",value:r.refreshToken},null,8,["value"]))]),_:1,__:[3]})]),_:1}))}}),I=w(P,[["__scopeId","data-v-39f0fed5"]]);export{I as C};
