import{d as v,V as T,X as S,a5 as h,Z as x,_ as C,$ as l,o as n,g as s,f as i,a1 as d,e as o,a0 as f,a as N,c as M}from"./app-BYVCkMFV.js";import{B as z}from"./Button-B9_OsJsT.js";import{N as B}from"./Input-BPd0b8cx.js";import{N as P}from"./Alert-CJ91sK0L.js";const U=v({__name:"Callback",setup(m,{expose:r}){r();const c=new URL(window.location.href),e=c.searchParams.get("code"),g=c.searchParams.get("state"),_=c.searchParams.get("error"),k=c.searchParams.get("error_description"),a=T({refreshToken:"",accessToken:"",error1:"",errorMessage1:"",siteUrl:"",siteId:"",error2:"",errorMessage2:"",gettingSiteId:!1}),p=()=>{fetch(`${S()}/alist/onedrive/get_refresh_token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,client:g})}).then(t=>t.json()).then(t=>{if(console.log(t),t.error){a.error1=t.error,a.errorMessage1=t.error_description;return}a.refreshToken=t.refresh_token,a.accessToken=t.access_token})};e&&g&&!_&&p();const[I,b,u]=atob(g).split("::"),y={url:c,code:e,client:g,error:_,error_description:k,data:a,getToken:p,client_id:I,client_secret:b,zone:u,getSiteId:()=>{a.gettingSiteId=!0,fetch(`${S()}/alist/onedrive/get_site_id`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({site_url:a.siteUrl,access_token:a.accessToken,zone:u})}).then(t=>(a.gettingSiteId=!1,t.json())).then(t=>{if(t.error){a.error2=t.error,a.errorMessage2=t.error.message;return}a.siteId=t.id})},get NAlert(){return P},get NButton(){return z},get NInput(){return B},get NSpace(){return x},get NSpin(){return h}};return Object.defineProperty(y,"__isScriptSetup",{enumerable:!1,value:!0}),y}}),j={key:2};function A(m,r,c,e,g,_){return!e.code||!e.client||e.error?(n(),l(e.NAlert,{key:0,title:e.error||"Error",type:"error"},{default:s(()=>[i(d(e.error_description),1)]),_:1},8,["title"])):(n(),l(e.NSpace,{key:1,vertical:"",size:"large"},{default:s(()=>[o("p",null,[r[1]||(r[1]=o("b",null,"client_id: ",-1)),i(d(e.client_id),1)]),o("p",null,[r[2]||(r[2]=o("b",null,"client_secret: ",-1)),i(d(e.client_secret),1)]),o("p",null,[r[3]||(r[3]=o("b",null,"zone: ",-1)),i(d(e.zone),1)]),r[8]||(r[8]=o("p",null,[o("b",null,"redirect_uri: "),i("https://alist.nn.ci/tool/onedrive/callback")],-1)),e.data.error1||e.data.errorMessage1?(n(),l(e.NAlert,{key:0,title:e.data.error1,type:"error"},{default:s(()=>[i(d(e.data.errorMessage1),1)]),_:1},8,["title"])):f("",!0),N(e.NSpace,{vertical:""},{default:s(()=>[r[4]||(r[4]=o("b",null,"refresh_token:",-1)),!e.data.refreshToken&&!e.data.errorMessage1?(n(),l(e.NSpin,{key:0})):(n(),l(e.NInput,{key:1,type:"textarea",autosize:"",readonly:"",value:e.data.refreshToken},null,8,["value"]))]),_:1}),e.data.accessToken?(n(),l(e.NSpace,{key:1,vertical:"",size:"large"},{default:s(()=>[r[7]||(r[7]=o("h3",null,"Get sharepoint site ID",-1)),e.data.error2||e.data.errorMessage2?(n(),l(e.NAlert,{key:0,title:e.data.error2,type:"error"},{default:s(()=>[i(d(e.data.errorMessage2),1)]),_:1},8,["title"])):f("",!0),N(e.NInput,{placeholder:"input site url (https://xx.sharepoint.xx/sites/xx)",size:"large",value:e.data.siteUrl,"onUpdate:value":r[0]||(r[0]=k=>e.data.siteUrl=k)},null,8,["value"]),N(e.NButton,{type:"primary",size:"large",onClick:e.getSiteId},{default:s(()=>r[5]||(r[5]=[i("Get SiteID")])),_:1}),e.data.gettingSiteId?(n(),l(e.NSpin,{key:1})):e.data.siteId?(n(),M("p",j,[r[6]||(r[6]=o("b",null,"site_id: ",-1)),i(d(e.data.siteId),1)])):f("",!0)]),_:1})):f("",!0)]),_:1}))}const G=C(U,[["render",A],["__scopeId","data-v-109d5915"],["__file","Callback.vue"]]);export{G as C};
